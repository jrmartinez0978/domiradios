<!-- Advanced Performance Optimizer for Domiradios -->

<!-- Critical CSS inline para eliminar bloqueo de renderizado -->
<style id="critical-css">
/* Carga del Critical CSS para mejorar First Contentful Paint */
@import url('/css/critical.css');
</style>

<!-- Optimizaciones para recursos que bloquean el renderizado -->
<script>
// Funci√≥n para cargar CSS de forma as√≠ncrona
function loadCSS(href) {
  const link = document.createElement('link');
  link.rel = 'stylesheet';
  link.href = href;
  link.media = 'print';
  document.head.appendChild(link);
  
  // Cambiar a 'all' cuando est√© cargado
  link.onload = function() {
    this.media = 'all';
  };
}

// Identificar y posponer CSS no cr√≠tico
document.addEventListener('DOMContentLoaded', function() {
  // Lista de todas las hojas de estilo
  const stylesheets = Array.from(document.querySelectorAll('link[rel="stylesheet"]'));
  
  // Mantener solo aquellas marcadas como cr√≠ticas
  stylesheets.forEach(function(stylesheet) {
    if (!stylesheet.getAttribute('data-critical')) {
      // Obtener la URL de la hoja de estilo
      const href = stylesheet.getAttribute('href');
      
      if (href) {
        // Eliminar la hoja de estilo original
        stylesheet.parentNode.removeChild(stylesheet);
        
        // Cargarla de forma as√≠ncrona
        requestIdleCallback(function() {
          loadCSS(href);
        });
      }
    }
  });
});

// Cargar im√°genes de forma inteligente y adaptativa
document.addEventListener('DOMContentLoaded', function() {
  // Cargar script optimizador de im√°genes
  const script = document.createElement('script');
  script.src = '/js/image-optimizer.js';
  script.async = true;
  document.body.appendChild(script);
});

// Optimizador de cach√© para recursos est√°ticos
function setupCacheControl() {
  // Lista de tipos de recursos est√°ticos
  const staticTypes = [
    '.css', '.js', '.jpg', '.jpeg', '.png', '.gif', '.webp', 
    '.svg', '.woff', '.woff2', '.ttf', '.eot'
  ];
  
  // Verificar todos los recursos cargados
  const resources = window.performance.getEntriesByType('resource');
  const cacheMisses = [];
  
  resources.forEach(function(resource) {
    const url = resource.name;
    const extension = url.substring(url.lastIndexOf('.'));
    
    // Comprobar si es un recurso est√°tico
    if (staticTypes.includes(extension)) {
      // Comprobar si este recurso podr√≠a beneficiarse de mejor cach√©
      if (!resource.transferSize || resource.transferSize > 1000) { // M√°s de 1KB
        cacheMisses.push({
          url: url,
          size: resource.transferSize || 0,
          type: extension
        });
      }
    }
  });
  
  // Reportar recursos que podr√≠an mejorarse (solo durante desarrollo)
  if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
    if (cacheMisses.length > 0) {
      console.group('üöÄ Recursos que podr√≠an beneficiarse de mejor cach√©:');
      console.table(cacheMisses);
      console.groupEnd();
    }
  }
}

// Ejecutar verificaci√≥n de cach√© despu√©s de carga completa
window.addEventListener('load', function() {
  // Dar tiempo para terminar de cargar todos los recursos
  setTimeout(setupCacheControl, 3000);
});
</script>

<!-- Optimizaci√≥n de tiempos de respuesta del servidor -->
<script>
// Prefetch para mejorar tiempos de respuesta
document.addEventListener('DOMContentLoaded', function() {
  // Enlaces que es probable que el usuario visite
  const likelyUrls = [
    '/emisoras',
    '/ciudades',
    '/contacto'
  ];
  
  // Esperar a que la p√°gina principal est√© cargada
  requestIdleCallback(function() {
    likelyUrls.forEach(function(url) {
      const link = document.createElement('link');
      link.rel = 'prefetch';
      link.href = url;
      document.head.appendChild(link);
    });
  });
});
</script>

<!-- Resource Hints para CDNs y recursos externos -->
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>

<!-- Instrucciones para uso -->
<!--
Para implementar esta soluci√≥n avanzada sin modificar tu c√≥digo existente:

1. Opci√≥n recomendada - Insertar al final del <head>:
   <?php echo file_get_contents(public_path('advanced-performance.html')); ?>

2. O puedes incluirlo justo antes del cierre </head>:
   <script>
   (function() {
     var xhr = new XMLHttpRequest();
     xhr.open('GET', '/advanced-performance.html', true);
     xhr.onreadystatechange = function() {
       if (xhr.readyState === 4 && xhr.status === 200) {
         var div = document.createElement('div');
         div.innerHTML = xhr.responseText;
         document.head.insertAdjacentHTML('beforeend', div.innerHTML);
       }
     };
     xhr.send();
   })();
   </script>

Esta configuraci√≥n deber√≠a resolver:
- Recursos que bloquean el renderizado (2.590ms)
- Optimizaci√≥n de im√°genes (949KB)
- Recursos est√°ticos (5 recursos identificados)
-->
