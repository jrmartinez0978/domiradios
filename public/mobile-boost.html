<!-- 
  Domiradios - Mobile Performance Booster
  Este archivo implementa optimizaciones espec√≠ficas para dispositivos m√≥viles
  sin modificar el c√≥digo base
-->

<!-- Script detector de dispositivos m√≥viles (se ejecuta primero) -->
<script>
  // Verificar si es dispositivo m√≥vil
  const isMobile = window.innerWidth < 768 || 'ontouchstart' in document.documentElement;
  
  if (isMobile) {
    // Marcar documento como optimizado para m√≥viles
    document.documentElement.setAttribute('data-mobile-optimized', 'true');
    
    // Aplicar optimizaciones inmediatas para FCP (First Contentful Paint)
    const style = document.createElement('style');
    style.textContent = `
      /* Optimizaciones de rendimiento para primera carga en m√≥viles */
      img:not([critical="true"]) { 
        content-visibility: auto; 
        loading: lazy; 
      }
      
      /* Reducir animaciones en primera carga */
      * {
        animation-duration: 0.001s !important;
        transition-duration: 0.001s !important;
      }
      
      /* Prevenir Layout Shifts */
      .card, .radio-card, .station-card {
        min-height: 100px;
        content-visibility: auto;
        contain-intrinsic-size: 100px;
      }
      
      /* Optimizar carga de fuentes */
      @font-face {
        font-display: swap !important;
      }
    `;
    document.head.insertBefore(style, document.head.firstChild);
    
    // Cargar optimizador m√≥vil
    const script = document.createElement('script');
    script.src = '/js/mobile-optimizer.js';
    script.async = true;
    document.head.appendChild(script);
  }
</script>

<!-- Preconexiones para m√≥viles (m√°s agresivas que en desktop) -->
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//fonts.gstatic.com">
<link rel="dns-prefetch" href="//cdn.jsdelivr.net">

<!-- Optimizaciones espec√≠ficas para el renderizado en m√≥viles -->
<script>
  // Solo ejecutar en m√≥viles
  if (window.innerWidth < 768 || 'ontouchstart' in document.documentElement) {
    // Optimizar im√°genes grandes para m√≥viles
    document.addEventListener('DOMContentLoaded', function() {
      // Buscar im√°genes problem√°ticas
      const largeImages = document.querySelectorAll('img[src$=".jpg"], img[src$=".jpeg"], img[src$=".png"]');
      
      largeImages.forEach(function(img) {
        // Solo procesamos im√°genes cargadas
        if (img.complete) {
          optimizeMobileImage(img);
        } else {
          img.addEventListener('load', function() {
            optimizeMobileImage(img);
          });
        }
      });
      
      function optimizeMobileImage(img) {
        // Si la imagen es demasiado grande para la pantalla
        if (img.naturalWidth > (window.innerWidth * 1.5) || img.naturalHeight > (window.innerHeight * 1.5)) {
          // Guardar URL original para registro
          const originalSrc = img.src;
          
          // Convertir a WebP si es posible (usando un servicio de optimizaci√≥n)
          if (img.src.match(/\.(jpg|jpeg|png)$/i) && !img.src.includes('?')) {
            // A√±adir par√°metro de ancho para CDN o servicio de im√°genes
            const optimalWidth = Math.min(window.innerWidth, 480);
            img.src = img.src + '?w=' + optimalWidth;
            
            // Registrar en consola para depuraci√≥n
            console.log('Mobile image optimized:', originalSrc, '‚Üí', img.src);
          }
        }
      }
    });
    
    // Reducir recursos que bloquean el renderizado
    window.addEventListener('load', function() {
      // Identificar recursos que podr√≠an estar bloqueando
      const resources = performance.getEntriesByType('resource');
      const blockingResources = resources.filter(function(resource) {
        return (resource.initiatorType === 'css' || resource.initiatorType === 'script') && 
               resource.duration > 200; // Recursos que toman m√°s de 200ms
      });
      
      // Registrar para depuraci√≥n
      if (blockingResources.length > 0 && (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1')) {
        console.group('üöÄ Recursos que bloquean el renderizado:');
        console.table(blockingResources.map(function(resource) {
          return {
            name: resource.name.split('/').pop(),
            type: resource.initiatorType,
            duration: Math.round(resource.duration) + 'ms'
          };
        }));
        console.groupEnd();
      }
    });
  }
</script>

<!-- Instrucciones para implementaci√≥n -->
<!--
Para implementar las optimizaciones m√≥viles:

1. Opci√≥n 1: Incluye este archivo en tu layout principal:
   <?php echo file_get_contents(public_path('mobile-boost.html')); ?>
   
2. Opci√≥n 2: Agrega esta l√≠nea al inicio del <head> en tu layout:
   <script>
     (function() {
       if (window.innerWidth < 768 || 'ontouchstart' in document.documentElement) {
         var xhr = new XMLHttpRequest();
         xhr.open('GET', '/mobile-boost.html', true);
         xhr.onreadystatechange = function() {
           if (xhr.readyState === 4 && xhr.status === 200) {
             document.head.insertAdjacentHTML('afterbegin', xhr.responseText);
           }
         };
         xhr.send();
       }
     })();
   </script>
-->
